function get_stack(a){if(a){return[a.toString().match(/.*\n.*\n/)].concat(get_stack(a.caller))}else{return[]}}Array.prototype.has=function(a){for(var b=this.length;b--;){if(this[b]==a){return true}}return false};(function($,undefined){function History(name){var enabled=true;if(typeof name==="string"&&name!==""){name+="_"}var data=$.Storage.get(name+"commands");var bc=new BCycle(data?eval("("+data+")"):[""]);$.extend(this,{append:function(a){if(enabled&&bc.current()!=a){bc.append(a);$.Storage.set(name+"commands",$.json_stringify(bc.data()))}},data:function(){return bc.data()},next:function(){return bc.right()},last:function(){bc.reset()},previous:function(){return bc.left()},clear:function(){bc=new BCycle;$.Storage.remove(name+"commands")},enable:function(){enabled=true},disable:function(){enabled=false}})}function Stack(a){var b=a?[a]:[];$.extend(this,{size:function(){return b.length},pop:function(){if(b.length===0){return null}else{var a=b[b.length-1];b=b.slice(0,b.length-1);return a}},push:function(a){b=b.concat([a]);return a},top:function(){return b.length>0?b[b.length-1]:null}})}function BCycle(a){var b=a instanceof Array?a:a?[a]:[];var c=0;$.extend(this,{left:function(){if(c===0){c=b.length-1}else{--c}return b[c]},right:function(){if(c==b.length-1){c=0}else{++c}return b[c]},current:function(){return b[c]},data:function(){return b},reset:function(){c=0},append:function(a){b.push(a);this.reset()}})}function Cycle(a){var b=a?[a]:[];var c=0;$.extend(this,{rotate:function(){if(b.length==1){return b[0]}else{if(c==b.length-1){c=0}else{++c}return b[c]}},length:function(){return b.length},set:function(a){for(var d=b.length;d--;){if(b[d]===a){c=d;return}}this.append(a)},front:function(){return b[c]},append:function(a){b.push(a)}})}function encodeHTML(a){if(typeof a=="string"){a=a.replace(/&(?!#[0-9]*;)/g,"&");a=a.replace(/</g,"<").replace(/>/g,">");a=a.replace(/\n/g,"<br/>");a=a.replace(/ /g," ");a=a.replace(/\t/g,"    ");var b=a.split(format_split_re);if(b.length>1){a=$.map(b,function(b){if(b[0]=="["){return b.replace(format_re,function(b,c,d,e,f){var g="";if(c.indexOf("b")!=-1){g+="font-weight:bold;"}if(c.indexOf("u")!=-1){g+="text-decoration:underline;"}if(c.indexOf("i")!=-1){g+="font-style:italic; "}if(d.match(color_hex_re)){g+="color:"+d+";"}if(e.match(color_hex_re)){g+="background-color:"+e}a='<span style="'+g+'">'+f+"</span>";return a})}else{return"<span>"+b+"</span>"}}).join("")}return a}else{return""}}function str_parts(a,b){var c=[];var d=a.length;if(d<b){return[a]}for(var e=0;e<d;e+=b){c.push(a.substring(e,e+b))}return c}function dc(a){return wc(a,"",-1)}function dls(a){return delete localStorage[a]}function rc(a){var b,c,d,e;b=a+"=";c=document.cookie.split(";");for(d=0;d<c.length;d++){e=c[d];while(e.charAt(0)===" "){e=e.substring(1,e.length)}if(e.indexOf(b)===0){return e.substring(b.length,e.length)}}return null}function rls(a){return localStorage[a]}function wc(a,b){var c,d,e;c=new Date;c.setTime(c.getTime()+31536e6);d="; expires="+c.toGMTString();if(typeof a==="string"&&typeof b==="string"){document.cookie=a+"="+b+d+"; path=/";return true}else if(typeof a==="object"&&typeof b==="undefined"){for(e in a){if(a.hasOwnProperty(e)){document.cookie=e+"="+a[e]+d+"; path=/"}}return true}return false}function wls(a,b){var c;if(typeof a==="string"&&typeof b==="string"){localStorage[a]=b;return true}else if(typeof a==="object"&&typeof b==="undefined"){for(c in a){if(a.hasOwnProperty(c)){localStorage[c]=a[c]}}return true}return false}$.extend($.fn,{livequery:function(a,b,c){var d=this,e;if($.isFunction(a))c=b,b=a,a=undefined;$.each($.livequery.queries,function(f,g){if(d.selector==g.selector&&d.context==g.context&&a==g.type&&(!b||b.$lqguid==g.fn.$lqguid)&&(!c||c.$lqguid==g.fn2.$lqguid))return(e=g)&&false});e=e||new $.livequery(this.selector,this.context,a,b,c);e.stopped=false;e.run();return this},expire:function(a,b,c){var d=this,e=10;if($.isFunction(a))c=b,b=a,a=undefined;$.each($.livequery.queries,function(e,f){if(d.selector==f.selector&&d.context==f.context&&(!a||a==f.type)&&(!b||b.$lqguid==f.fn.$lqguid)&&(!c||c.$lqguid==f.fn2.$lqguid)&&!this.stopped)$.livequery.stop(f.id)});return this}});$.livequery=function(a,b,c,d,e){this.selector=a;this.context=b||document;this.type=c;this.fn=d;this.fn2=e;this.elements=[];this.stopped=false;this.id=$.livequery.queries.push(this)-1;d.$lqguid=d.$lqguid||$.livequery.guid++;if(e)e.$lqguid=e.$lqguid||$.livequery.guid++;return this};$.livequery.prototype={stop:function(){var a=this;if(this.type)this.elements.unbind(this.type,this.fn);else if(this.fn2)this.elements.each(function(b,c){a.fn2.apply(c)});this.elements=[];this.stopped=true},run:function(){if(this.stopped)return;var a=this;var b=this.elements,c=$(this.selector,this.context),d=c.not(b);this.elements=c;if(this.type){d.bind(this.type,this.fn);if(b.length>0)$.each(b,function(b,d){if($.inArray(d,c)<0)$.event.remove(d,a.type,a.fn)})}else{d.each(function(){a.fn.apply(this)});if(this.fn2&&b.length>0)$.each(b,function(b,d){if($.inArray(d,c)<0)a.fn2.apply(d)})}}};$.extend($.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if($.livequery.running&&$.livequery.queue.length){var a=$.livequery.queue.length;while(a--)$.livequery.queries[$.livequery.queue.shift()].run()}},pause:function(){$.livequery.running=false},play:function(){$.livequery.running=true;$.livequery.run()},registerPlugin:function(){$.each(arguments,function(a,b){if(!$.fn[b])return;var c=$.fn[b];$.fn[b]=function(){var a=c.apply(this,arguments);$.livequery.run();return a}})},run:function(a){if(a!=undefined){if($.inArray(a,$.livequery.queue)<0)$.livequery.queue.push(a)}else $.each($.livequery.queries,function(a){if($.inArray(a,$.livequery.queue)<0)$.livequery.queue.push(a)});if($.livequery.timeout)clearTimeout($.livequery.timeout);$.livequery.timeout=setTimeout($.livequery.checkQueue,20)},stop:function(a){if(a!=undefined)$.livequery.queries[a].stop();else $.each($.livequery.queries,function(a){$.livequery.queries[a].stop()})}});$.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove");$(function(){$.livequery.play()});var init=$.prototype.init;$.prototype.init=function(a,b){var c=init.apply(this,arguments);if(a&&a.selector)c.context=a.context,c.selector=a.selector;if(typeof a=="string")c.context=b||document,c.selector=a;return c};$.prototype.init.prototype=$.prototype;var isLS=typeof window.localStorage!=="undefined";$.extend({Storage:{set:isLS?wls:wc,get:isLS?rls:rc,remove:isLS?dls:dc}});jQuery.fn.extend({everyTime:function(a,b,c,d,e){return this.each(function(){jQuery.timer.add(this,a,b,c,d,e)})},oneTime:function(a,b,c){return this.each(function(){jQuery.timer.add(this,a,b,c,1)})},stopTime:function(a,b){return this.each(function(){jQuery.timer.remove(this,a,b)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(a){if(a==undefined||a==null)return null;var b=this.regex.exec(jQuery.trim(a.toString()));if(b[2]){var c=parseInt(b[1],10);var d=this.powers[b[2]]||1;return c*d}else{return a}},add:function(a,b,c,d,e,f){var g=0;if(jQuery.isFunction(c)){if(!e)e=d;d=c;c=b}b=jQuery.timer.timeParse(b);if(typeof b!="number"||isNaN(b)||b<=0){return}if(e&&e.constructor!=Number){f=!!e;e=0}e=e||0;f=f||false;if(!a.$timers)a.$timers={};if(!a.$timers[c])a.$timers[c]={};d.$timerID=d.$timerID||this.guid++;var h=function(){if(f&&this.inProgress)return;this.inProgress=true;if(++g>e&&e!==0||d.call(a,g)===false)jQuery.timer.remove(a,c,d);this.inProgress=false};h.$timerID=d.$timerID;if(!a.$timers[c][d.$timerID])a.$timers[c][d.$timerID]=window.setInterval(h,b);if(!this.global[c])this.global[c]=[];this.global[c].push(a)},remove:function(a,b,c){var d=a.$timers,e;if(d){if(!b){for(b in d)this.remove(a,b,c)}else if(d[b]){if(c){if(c.$timerID){window.clearInterval(d[b][c.$timerID]);delete d[b][c.$timerID]}}else{for(var c in d[b]){window.clearInterval(d[b][c]);delete d[b][c]}}for(e in d[b])break;if(!e){e=null;delete d[b]}}for(e in d)break;if(!e)a.$timers=null}}}});if(jQuery.browser.msie){jQuery(window).one("unload",function(){var a=jQuery.timer.global;for(var b in a){var c=a[b],d=c.length;while(--d)jQuery.timer.remove(c[d],b)}})}var format_split_re=/(\[\[[biu]*;[^;]*;[^\]]*\][^\]]*\])/g;var format_re=/\[\[([biu]*);([^;]*);([^\]]*)\]([^\]]*)\]/g;var color_hex_re=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/;$.json_stringify=function(a,b){var c="";b=b===undefined?1:b;var d=typeof a;switch(d){case"function":c+=a;break;case"boolean":c+=a?"true":"false";break;case"object":if(a===null){c+="null"}else if(a instanceof Array){c+="[";var e=a.length;for(var f=0;f<e-1;++f){c+=$.json_stringify(a[f],b+1)}c+=$.json_stringify(a[e-1],b+1)+"]"}else{c+="{";for(var g in a){if(a.hasOwnProperty(g)){c+='"'+g+'":'+$.json_stringify(a[g],b+1)}}c+="}"}break;case"string":var h=a;var i={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(var f in i){if(i.hasOwnProperty(f)){h=h.replace(new RegExp(f,"g"),i[f])}}c+='"'+h+'"';break;case"number":c+=String(a);break}c+=b>1?",":"";if(b==1){c=c.replace(/,([\]}])/g,"$1")}return c.replace(/([\[{]),/g,"$1")};$.fn.cmd=function(a){function t(c){if(a.keydown&&a.keydown(c)===false){return false}if(j){var d,e,f;if(c.keyCode==13){if(l&&g){l.append(g)}l.last();var k=g;b.set("");if(typeof i=="function"){r()}if(a.commands){a.commands(k)}}else if(c.which==32){b.insert(" ")}else if(c.which==8){if(g!==""&&h>0){g=g.slice(0,h-1)+g.slice(h,g.length);--h;q()}}else if(c.which==9&&!(c.ctrlKey||c.altKey)){b.insert("\t")}else if(c.which==46||c.which==68&&c.ctrlKey){if(g!==""&&h<g.length){g=g.slice(0,h)+g.slice(h+1,g.length);q()}return true}else if(l&&c.which==38||c.which==80&&c.ctrlKey){b.set(l.previous())}else if(l&&c.which==40||c.which==78&&c.ctrlKey){b.set(l.next())}else if(c.which==27){b.set("")}else if(c.which==37||c.which==66&&c.ctrlKey){if(c.ctrlKey&&c.which!=66){e=h-1;d=0;if(g[e]==" "){--e}for(var m=e;m>0;--m){if(g[m]==" "&&g[m+1]!=" "){d=m+1;break}}b.position(d)}else{if(h>0){--h;q()}}}else if(c.which==39||c.which==70&&c.ctrlKey){if(c.ctrlKey&&c.which!=70){if(g[h]==" "){++h}var n=g.slice(h).match(/[^ ] {2,}| +[^ ]?/);if(!n||n[0].match(/^ +$/)){h=g.length}else{if(n[0][0]!=" "){h+=n.index+1}else{h+=n.index+n[0].length-1;if(n[0][n[0].length-1]!=" "){--h}}}q()}else{if(h<g.length){++h;q()}}}else if(c.which==123){return true}else if(c.which==36){b.position(0)}else if(c.which==35){b.position(g.length)}else if(c.ctrlKey||c.metaKey){if(c.shiftKey){if(c.which==84){return true}}else if(c.altKey){}else{if(c.which==65){b.position(0)}else if(c.which==69){b.position(g.length)}else if(c.which==88||c.which==67||c.which==87||c.which==84){return true}else if(c.which==86){s();return true}else if(c.which==75){if(h===0){b.set("")}else if(h!=g.length){b.set(g.slice(0,h))}}else if(c.which==17){return true}}}else if(c.altKey){if(c.which==68){b.set(g.slice(0,h)+g.slice(h).replace(/[^ ]+ |[^ ]+$/,""),true)}}else{return true}return false}}function s(){c.focus();b.oneTime(1,function(){b.insert(c.val());c.blur();c.val("")})}function p(a){var b=a.substring(0,d-e-1);var c=a.substring(d-e-1);return[b].concat(str_parts(c,d))}function o(){var a=b.width();var c=n.innerWidth();d=Math.floor(a/c)}var b=this;b.addClass("cmd");b.append('<span class="prompt"></span><span></span>'+'<span class="cursor"> </span><span></span>');var c=$("<textarea/>").addClass("clipboard").appendTo(b);if(a.width){b.width(a.width)}var d;var e;var f=a.mask||false;var g="";var h=0;var i;var j=a.enabled;var k,l;var m=function(){var a=b.find(".cursor");return function(b){a.toggleClass("inverted")}}();var n=b.find(".cursor");var q=function(a){function m(a){$.each(a,function(a,b){c.before(k(b))})}function l(a){var b=i;$.each(a,function(a,c){b=$(k(c)).insertAfter(b)})}function k(a){return"<div>"+encodeHTML(a)+"</div>"}function j(a,d){if(d==a.length){c.html(encodeHTML(a));b.html(" ");i.html("")}else if(d===0){c.html("");b.html(encodeHTML(a.slice(0,1)));i.html(encodeHTML(a.slice(1)))}else{var e=encodeHTML(a.slice(0,d));c.html(e);var f=a.slice(d,d+1);b.html(f==" "?" ":encodeHTML(f));if(d==a.lenght-1){i.html("")}else{i.html(encodeHTML(a.slice(d+1)))}}}var b=a.find(".cursor");var c=b.prev();var i=b.next();var n=0;return function(){var n=f?g.replace(/./g,"*"):g;a.find("div").remove();c.html("");if(n.length>d-e-1){var o=p(n);var q=o[0].length;if(h<q){j(o[0],h);l(o.slice(1))}else if(h==q){c.before(k(o[0]));j(o[1],0);l(o.slice(2))}else{var r=o.length;var s=0;if(h<q){j(o[0],h);l(o.slice(1))}else if(h==q){c.before(k(o[0]));j(o[1],0);l(o.slice(2))}else{var t=o.slice(-1)[0];var u=n.length-h;if(u<=t.length){m(o.slice(0,-1));var v=t.length==u?0:t.length-u;j(t,v)}else{if(r==3){c.before("<div>"+encodeHTML(o[0])+"</div>");j(o[1],h-q-1);i.after("<div>"+encodeHTML(o[2])+"</div>")}else{var w=Math.floor((h+e)/d);var x=o[w];var y=function(a){var b=0;for(var c=a.length;c--;){b+=a[c].length}return b}(o.slice(0,w));var v=h-y;if(v==d){v=0;x=o[++w]}var z=encodeHTML(x.slice(0,v));j(x,v);m(o.slice(0,w));l(o.slice(w+1))}}}}}else{if(n===""){c.html("");b.html(" ");i.html("")}else{j(n,h)}}}}(b);var r=function(){var a=b.find(".prompt");return function(){if(typeof i=="string"){e=i.length;a.html(encodeHTML(i)+" ")}else{i(function(b){e=b.length;a.html(encodeHTML(b)+" ")})}}}();$.extend(b,{name:function(a){if(a!==undefined){k=a;l=new History(a)}else{return k}},history:function(){return l},set:function(a,b){if(a!==undefined){g=a;if(!b){h=g.length}q()}},insert:function(a,b){if(h==g.length){g+=a}else if(h===0){g=a+g}else{g=g.slice(0,h)+a+g.slice(h)}if(!b){h+=a.length}q()},get:function(){return g},commands:function(b){if(b){a.commands=b}else{return b}},destroy:function(){$(document.documentElement).unbind(".commandline");b.find(".prompt").remove()},prompt:function(a){if(a===undefined){return i}else{if(typeof a=="string"||typeof a=="function"){i=a}else{throw"prompt must be a function or string"}r()}},position:function(a){if(typeof a=="number"){h=a<0?0:a>g.length?g.length:a;q()}else{return h}},resize:function(a){if(a){d=a}else{o()}q()},enable:function(){if(!j){b.everyTime(500,"blink",m);j=true}},isenabled:function(){return j},disable:function(){if(j){b.stopTime("blink",m);b.find(".cursor").removeClass("inverted");j=false}},mask:function(a){if(typeof a=="boolean"){f=a;q()}else{return f}}});b.name(a.name||"");i=a.prompt||">";r();if(a.enabled===undefined||a.enabled===true){b.enable()}$(document.documentElement).keypress(function(c){var d;if(c.ctrlKey&&c.which==99){return true}if(a.keypress){d=a.keypress(c)}if(d===undefined||d){if(j){if([38,32,13,0,8].has(c.which)&&c.keyCode!=123&&!(c.which==38&&c.shiftKey)){return false}else if(!c.ctrlKey&&!(c.altKey&&c.which==100)){b.insert(String.fromCharCode(c.which));return false}}}else{return d}if(c.which==100&&c.ctrlKey){return false}}).keydown(t);return b};var requests=[];$.jrpc=function(a,b,c,d,e,f){var g=$.json_stringify({jsonrpc:"2.0",method:c,params:d,id:b});return $.ajax({url:a,data:g,success:e,error:f,contentType:"application/json",dataType:"json",beforeSend:function(a,b){requests.push(a)},async:true,cache:false,type:"POST"})};var version="0.3.5";var copyright="Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>";var version_string="version "+version;var reg=new RegExp(" {"+version_string.length+"}$");var signatures=[["jQuery Terminal","(c) 2011 jcubic"],["JQuery Terminal Emulator v. "+version,copyright.replace(/ *<.*>/,"")],["JQuery Terminal Emulator version "+version_string,copyright],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(reg,"")+version_string,copyright],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(reg,"")+version_string,copyright]];var terminals=new Cycle;var requests=[];$.fn.terminal=function(a,b){function A(a){if(h.keypress&&h.keypress(a,c)===false){return false}if(!c.paused()){if(a.which==100&&a.ctrlKey){if(h.exit&&C.get()===""){if(B.size()>1||h.login!==undefined){c.pop("")}else{c.resume();c.echo("")}}return false}else if(a.which==118&&a.ctrlKey){c.oneTime(1,function(){m()});return true}else if(a.keyCode==9&&a.ctrlKey){c.focus(false)}else if(a.keyCode==34){c.scroll(c.height())}else if(a.keyCode==33){c.scroll(-c.height())}else{c.attr({scrollTop:c.attr("scrollHeight")})}}else{if(a.which==100&&a.ctrlKey){for(var b=requests.length;b--;){var d=requests[b];if(4!=d.readyState){try{d.abort()}catch(a){c.error("error in aborting ajax")}}}c.resume();return false}}}function z(){y();q();if(typeof h.onInit=="function"){h.onInit(c)}}function y(){var a=B.top();var b="";if(a.name!==undefined&&a.name!==""){b+=a.name+"_"}b+=f;C.name(b);C.prompt(a.prompt);if(h.history){C.history().enable()}C.set("");if(typeof a.onStart=="function"){a.onStart(c)}}function x(){var a=h.name;a=a?"_"+a:"";$.Storage.remove("token"+a,null);$.Storage.remove("login"+a,null);if(h.history){C.history().disable()}w()}function w(){var a=null;C.prompt("login:");if(h.history){C.history().disable()}C.commands(function(b){try{u(b);if(!a){a=b;C.prompt("password:");C.mask(true)}else{C.mask(false);c.pause();h.login(a,b,function(b){if(b){var d=h.name;d=d?"_"+d:"";$.Storage.set("token"+d,b);$.Storage.set("login"+d,a);C.commands(v);z()}else{c.error("Wrong password try again");C.prompt("login:");a=null}c.resume();if(h.history){C.history().enable()}})}}catch(d){k(d,"LOGIN",c);throw d}})}function v(a){try{var b=B.top();if(a=="exit"&&h.exit){if(B.size()==1){if(h.login){x()}else{var d="You can exit from main interpeter";c.echo(d)}}else{c.pop("exit")}}else{u(a);if(a=="clear"&&h.clear){c.clear()}else{b["eval"](a,c)}}}catch(e){k(e,"USER");throw e}}function u(a){var b=C.prompt();if(C.mask()){a=a.replace(/./g,"*")}if(typeof b=="function"){b(function(b){c.echo(b+" "+a)})}else{c.echo(b+" "+a)}}function s(a,b){var c=1;var d=function(d,e){b.pause();$.jrpc(a,c++,d,e,function(a){if(!a.error){if(typeof a.result=="string"){b.echo(a.result)}else if(a.result instanceof Array){b.echo(a.result.join(" "))}else if(typeof a.result=="object"){var c="";for(var d in a.result){if(a.result.hasOwnProperty(d)){c+=d+": "+a.result[d]+"\n"}}b.echo(c)}}else{b.error("&#91;RPC&#93; "+a.error.message)}b.resume()},function(a,c,d){b.error("&#91;AJAX&#93; "+c+" - Server reponse is: \n"+a.responseText);b.resume()})};return function(a,b){if(a===""){return}var c,e;if(!a.match(/[^ ]* /)){c=a;e=[]}else{a=a.split(/ +/);c=a[0];e=a.slice(1)}if(!h.login||c=="help"){d(c,e)}else{var f=b.token();if(f){d(c,[f].concat(e))}else{b.error("&#91;AUTH&#93; Access denied (no token)")}}}}function r(a){var b=$(window).scrollTop();var c=b+$(window).height();var d=$(a).offset().top;var e=d+$(a).height();return e>=b&&d<=c}function q(){if(b.greetings===undefined){c.echo(c.signature)}else if(b.greetings){c.echo(b.greetings)}}function p(a){var a=typeof a=="string"?a:String(a);var b;if(a.length>g){var c=a.split("\n");b=$("<div></div>");var d=c.length;for(var f=0;f<d;++f){if(c[f]===""||c[f]=="\r"){b.append("<div> </div>")}else{if(c[f].length>g){var h=str_parts(c[f],g);$.each(h,function(a,c){$("<div/>").html(encodeHTML(c)).appendTo(b)})}else{$("<div/>").html(encodeHTML(c[f])).appendTo(b)}}}}else{b=$("<div/>").html(encodeHTML(a))}e.append(b);b.width("100%");m();return b}function o(a){C.disable();div=$("<div> </div>");e.append(div);div.width("100%");m();n(a,div,0);return div}function n(a,b,c){b.html(a.substr(0,c++));if(c<a.length+1){setTimeout(function(){n(a,b,c)},Math.random()*h.keystroke_max_delay_milliseconds)}else{C.enable()}}function m(){var a=c.prop?c.prop("scrollHeight"):c.attr("scrollHeight");c.scrollTop(a)}function l(a,b){try{if(typeof b=="function"){b(function(){})}else if(typeof b!="string"){var c=a+" must be string or function";throw c}}catch(d){k(d,a.toUpperCase());return false}return true}function k(a,b){if(typeof a=="string"){c.error("&#91;"+b+"&#93;: "+a)}else{c.error("&#91;"+b+"&#93;: "+a.fileName+": "+a.message);c.pause();$.get(a.fileName,function(b){c.resume();var d=a.lineNumber-1;c.error("&#91;"+a.lineNumber+"&#93;: "+b.split("\n")[d])})}}function j(){var a=$("<span>x</span>").appendTo(c);var b=Math.floor(c.width()/a.width());a.remove();return b}var c=this;var d=[];var e;var f=function(){return terminals.length()}();var g;var h={name:null,prompt:">",history:true,exit:true,clear:true,enabled:true,login:null,onInit:null,onExit:null,keypress:null,keydown:null};if(b){if(b.width){c.width(b.width)}if(b.height){c.height(b.height)}$.extend(h,b)}var i=!h.enabled;if(c.length===0){throw'Sorry, but terminal said that "'+c.selector+'" is not valid selector'}if(c.data("terminal")){c.ajaxSend(function(a,b,c){requests.push(b)});return c.data("terminal")}e=$("<div>").addClass("terminal-output").appendTo(c);c.addClass("terminal").append("<div/>");$.extend(c,{clear:function(){e.html("");C.set("");d=[];c.attr({scrollTop:0});return c},paused:function(){return i},pause:function(){if(C){c.disable();C.hide()}return c},resume:function(){if(C){c.enable();C.show();m()}return c},cols:function(){return g},rows:function(){return d.length},history:function(){return C.history().data()},next:function(){if(terminals.length()==1){return c}else{var a=c.offset().top;var b=c.height();var d=c.scrollTop();if(!r(c)){c.enable();$("html,body").animate({scrollTop:a-50},500);return c}else{terminals.front().disable();var e=terminals.rotate().enable();var f=e.offset().top-50;$("html,body").animate({scrollTop:f},500);return e}}},focus:function(a){c.oneTime(1,function(){if(terminals.length()==1){if(a===false){c.disable()}else{c.enable()}}else{if(a===false){c.next()}else{terminals.front().disable();terminals.set(c);c.enable()}}});return c},enable:function(){if(g===undefined){c.resize()}if(i){if(C){C.enable();i=false}}return c},disable:function(){if(C){i=true;C.disable()}return c},enabled:function(){return i},signature:function(){var a=c.cols();var b=a<15?null:a<35?0:a<55?1:a<64?2:a<75?3:4;if(b!==null){return signatures[b].join("\n")+"\n"}else{return""}},get_command:function(){return C.get()},insert:function(a){C.insert(a);return c},set_prompt:function(a){if(l("prompt",a)){C.prompt(a)}return c},set_command:function(a){C.set(a);return c},set_mask:function(a){C.mask(a);return c},get_output:function(){return $.map(d,function(a,b){return typeof b=="function"?b():b}).get().join("\n")},resize:function(a,b){if(h.keystroke_max_delay_milliseconds){return}if(a&&b){c.width(a);c.height(b)}g=j();C.resize(g);var f=e.detach();e.html("");$.each(d,function(a,b){p(typeof b=="function"?b():b)});c.prepend(f);m();return c},echo:function(a){d.push(a);return p(typeof a=="function"?a():a)},echo_with_staggered_keystrokes:function(a){if(!h.keystroke_max_delay_milliseconds){return echo(a)}d.push(a);return o(a)},error:function(a){c.echo(a).addClass("error")},scroll:function(a){if(c.prop){if(a>c.prop("scrollTop")&&a>0){c.prop("scrollTop",0)}var b=c.prop("scrollTop");c.prop("scrollTop",b+a);return c}else{if(a>c.attr("scrollTop")&&a>0){c.attr("scrollTop",0)}var b=c.attr("scrollTop");c.attr("scrollTop",b+a);return c}},logout:h.login?function(){while(B.size()>1){B.pop()}x();return c}:function(){throw"You don't have login function"},token:h.login?function(){var a=h.name;return $.Storage.get("token"+(a?"_"+a:""))}:null,login_name:h.login?function(){var a=h.name;return $.Storage.get("login_"+(a?"_"+a:""))}:null,name:function(){return h.name},push:function(a,b){if(!b.prompt||l("prompt",b.prompt)){if(typeof a=="string"){var d=b["eval"];a=s(d,c)}B.push($.extend({eval:a},b));y()}return c},pop:function(a){if(a!==undefined){u(a)}if(B.top().name===h.name){if(h.login){x();if(typeof h.onExit=="function"){h.onExit(c)}}}else{var b=B.pop();y();if(typeof b.onExit=="function"){b.onExit(c)}}return c}});var t;switch(typeof a){case"string":t=a;a=s(a,c);break;case"object":a=function(a){return function(b,d){if(b==""){return}b=b.split(/ */);var e=b[0];var f=b.slice(1);var g=a[e];if(typeof g=="function"){g.apply(c,f)}else{c.echo("Command '"+e+"' Not Found")}}}(a);break}if(t&&typeof h.login=="string"||t){h.login=function(a){var b=1;return function(d,e,f){c.pause();$.jrpc(t,b++,a,[d,e],function(a){c.resume();if(!a.error&&a.result){f(a.result)}else{f(null)}},function(a,b,d){c.resume();c.error("&#91;AJAX&#92; Response: "+b+"\n"+a.responseText)})}}(typeof h.login=="boolean"?"login":h.login)}if(l("prompt",h.prompt)){var B=new Stack({name:h.name,eval:a,prompt:h.prompt,greetings:h.greetings});var C=c.find(".terminal-output").next().cmd({prompt:h.prompt,history:h.history,width:"100%",keydown:h.keydown?function(a){return h.keydown(a,c)}:null,keypress:A,commands:v});c.livequery(function(){c.resize()});terminals.append(c);if(h.enabled===true){c.focus()}else{c.disable()}$(window).resize(c.resize);c.click(function(){c.focus()});if(c.token&&!c.token()&&c.login_name&&!c.login_name()){w()}else{z()}if(typeof $.fn.init.prototype.mousewheel==="function"){c.mousewheel(function(a,b){if(b>0){c.scroll(-40)}else{c.scroll(40)}return false},true)}}c.data("terminal",c);return c}})(jQuery)
